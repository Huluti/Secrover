{% extends "base.html" %}

{% block title %}Dependencies Report{% endblock %}

{% block content %}
    <section id="global-recap">
        <h1>ðŸ“¦ Dependencies Report</h1>
        <div class="vulnerability-badges">
            {% for level in severity_order %}
            <span class="badge badge-{{ level }}">
                {{ severity_emojis[level] }} {{ level.capitalize() }}: {{ global_summary[level] }}
            </span>
            {% endfor %}
            <span class="badge badge-total">ðŸ“ˆ Total: {{ global_summary.total }}</span>
        </div>
    </section>

    <div id="repos">
        {% for repo_name, repo_data in data.items() %}
            {% set audit = repo_data.audit %}
            {% if not audit %}
                <div class="project-card">
                    <div class="project-header">
                        <h3>{{ repo_name }}</h3>
                    </div>
                    <p class="project-description">{{ repo_data.description }}</p>
                    <p class="mb-0">No audit data available.</p>
                </div>
            {% else %}
                <div class="project-card">
                    <div class="project-header">
                        <h3>{{ repo_name }}</h3>
                        <span class="badge-small badge-basic">{{ repo_data.language }}</span>
                    </div>
                    <p class="project-description">{{ repo_data.description }}</p>

                    <p><strong>ðŸŽ¯ Severity Breakdown:</strong></p>
                    <div class="vulnerability-badges mb-20">
                        {% for level in severity_order %}
                        <span class="badge badge-{{ level }}">
                            {{ severity_emojis[level] }} {{ level.capitalize() }}: {{ audit.vulnerabilities_by_severity.get(level, 0) }}
                        </span>
                        {% endfor %}
                        <span class="badge badge-total">ðŸ“ˆ Total: {{ audit.total_vulnerabilities }}</span>
                    </div>

                    <p><strong>ðŸ“¦ Impacted Packages:</strong></p>
                    <div class="packages-list mb-20">
                        {% if audit.packages_impacted %}
                            {% for pkg in audit.packages_impacted %}
                            <div class="{{ pkg.severity }}">{{ pkg.name }}</div>
                            {% endfor %}
                        {% else %}
                            <p class="no-issues mb-0">None - All clear!</p>
                        {% endif %}
                    </div>

                    {% if 'abandoned_packages' in audit %}
                    <p><strong>ðŸ“¦ Abandoned Packages:</strong></p>
                    <div class="packages-list">
                        {% if audit.abandoned_packages %}
                            {% for pkg in audit.abandoned_packages | sort %}
                            <div>{{ pkg }}</div>
                            {% endfor %}
                        {% else %}
                            <p class="no-issues mb-0">None â€“ All clear!</p>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            {% endif %}
        {% endfor %}
    </div>

{% endblock %}